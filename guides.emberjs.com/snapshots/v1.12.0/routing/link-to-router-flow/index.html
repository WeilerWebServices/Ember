<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">

    <title>Ember.js - Routing</title>
    <meta property="st:title" content="Routing" />
    <link href="../../images/favicon.png" rel="icon" type="image/png" />
    <!--[if lte IE 7 ]><link href="../../stylesheets/fonts/fontello-ie7.css" rel="stylesheet" type="text/css" /><![endif]-->
    <link href="../../stylesheets/site.css" rel="stylesheet" type="text/css" />
    <link href="/blog/feed.xml" rel="alternate" type="application/atom+xml" title="Ember.js - Blog" />
    
  </head>

  <body class="guides routing routing_link-to-router-flow routing_link-to-router-flow_index">

    <!--[if lt IE 9]>
      <script src="../../javascripts/common-old-ie.js" type="text/javascript"></script>
    <![endif]-->
    <!--[if gte IE 9]><!-->
      <script src="../../javascripts/common-modern.js" type="text/javascript"></script>
    <!--<![endif]-->

    <div id="header">
      <div id="wrapper">
        <a id="logo" href="http://emberjs.com/">&nbsp;</a>
        <ul id="nav">
          <li>
            <a href="http://emberjs.com/">about</a>
          </li>
          <li class="active">
            <a href="/">guides</a>
          </li>
          <li>
            <a href="http://emberjs.com/api">api</a>
          </li>
          <li>
            <a href="http://emberjs.com/community">community</a>
          </li>
          <li>
            <a href="http://emberjs.com/blog">blog</a>
          </li>
          <li>
            <a href="http://emberjs.com/builds">builds</a>
          </li>

          <li id="search">
            <form>
              <input type="text" id="st-search-input" class="st-search-input" placeholder="Search the guides"/>
            </form>
            <div id="st-results-container"></div>
          </li>
        </ul>

        <div id="github">
          <a href="https://github.com/emberjs/ember.js"><i class="icon-fork"></i>Fork Us!</a>
        </div>
      </div>
    </div>

    

    <div id="content-wrapper">
      <div id="sidebar-wrapper">
        <select class="version-select" style="width: 100%"></select>
        <div id="sidebar">

          <ol id='toc-list'><li class='level-1 '><a href="../../getting-started/">Getting Started</a><ol class=''><li class='level-3 '><a href="../../getting-started/">Installing Ember</a></li><li class='level-3 '><a href="../../getting-started/glossary/">Glossary</a></li></ol></li><li class='level-1 '><a href="../../concepts/core-concepts/">Concepts</a><ol class=''><li class='level-3 '><a href="../../concepts/core-concepts/">Core Concepts</a></li><li class='level-3 '><a href="../../concepts/naming-conventions/">Naming Conventions</a></li></ol></li><li class='level-1 '><a href="../../object-model/classes-and-instances/">The Object Model</a><ol class=''><li class='level-3 '><a href="../../object-model/classes-and-instances/">Classes and Instances</a></li><li class='level-3 '><a href="../../object-model/reopening-classes-and-instances/">Reopening Classes and Instances</a></li><li class='level-3 '><a href="../../object-model/computed-properties/">Computed Properties</a></li><li class='level-3 '><a href="../../object-model/computed-properties-and-aggregate-data/">Computed Properties and Aggregate Data with @each</a></li><li class='level-3 '><a href="../../object-model/observers/">Observers</a></li><li class='level-3 '><a href="../../object-model/bindings/">Bindings</a></li><li class='level-3 '><a href="../../object-model/what-do-i-use-when/">Bindings, Observers, Computed Properties: What Do I Use When?</a></li></ol></li><li class='level-1 '><a href="../../application/">Application</a><ol class=''><li class='level-3 '><a href="../../application/">Introduction</a></li></ol></li><li class='level-1 '><a href="../../templates/handlebars-basics/">Templates</a><ol class=''><li class='level-3 '><a href="../../templates/handlebars-basics/">Handlebars Basics</a></li><li class='level-3 '><a href="../../templates/the-application-template/">The Application Template</a></li><li class='level-3 '><a href="../../templates/conditionals/">Conditionals</a></li><li class='level-3 '><a href="../../templates/displaying-a-list-of-items/">Displaying a List of Items</a></li><li class='level-3 '><a href="../../templates/binding-element-attributes/">Binding Element Attributes</a></li><li class='level-3 '><a href="../../templates/binding-element-class-names/">Binding Element Class Names</a></li><li class='level-3 '><a href="../../templates/links/">Links</a></li><li class='level-3 '><a href="../../templates/actions/">Actions</a></li><li class='level-3 '><a href="../../templates/input-helpers/">Input Helpers</a></li><li class='level-3 '><a href="../../templates/development-helpers/">Development Helpers</a></li><li class='level-3 '><a href="../../templates/rendering-with-helpers/">Rendering with Helpers</a></li><li class='level-3 '><a href="../../templates/writing-helpers/">Writing Helpers</a></li></ol></li><li class='level-1 selected'><a href="../">Routing</a><ol class='selected'><li class='level-3 '><a href="../">Introduction</a></li><li class='level-3 '><a href="../defining-your-routes/">Defining Your Routes</a></li><li class='level-3 '><a href="../generated-objects/">Generated Objects</a></li><li class='level-3 '><a href="../specifying-a-routes-model/">Specifying a Route's Model</a></li><li class='level-3 '><a href="../setting-up-a-controller/">Setting Up a Controller</a></li><li class='level-3 '><a href="../rendering-a-template/">Rendering a Template</a></li><li class='level-3 '><a href="../redirection/">Redirecting</a></li><li class='level-3 '><a href="../specifying-the-location-api/">Specifying the URL Type</a></li><li class='level-3 '><a href="../query-params/">Query Parameters</a></li><li class='level-3 '><a href="../asynchronous-routing/">Asynchronous Routing</a></li><li class='level-3 '><a href="../loading-and-error-substates/">Loading / Error Substates</a></li><li class='level-3 '><a href="../preventing-and-retrying-transitions/">Preventing and Retrying Transitions</a></li></ol></li><li class='level-1 '><a href="../../components/">Components</a><ol class=''><li class='level-3 '><a href="../../components/">Introduction</a></li><li class='level-3 '><a href="../../components/defining-a-component/">Defining a Component</a></li><li class='level-3 '><a href="../../components/passing-properties-to-a-component/">Passing Properties to a Component</a></li><li class='level-3 '><a href="../../components/wrapping-content-in-a-component/">Wrapping Content in a Component</a></li><li class='level-3 '><a href="../../components/customizing-a-components-element/">Customizing a Component's Element</a></li><li class='level-3 '><a href="../../components/handling-user-interaction-with-actions/">Handling User Interaction with Actions</a></li><li class='level-3 '><a href="../../components/sending-actions-from-components-to-your-application/">Sending Actions from Components to Your Application</a></li></ol></li><li class='level-1 '><a href="../../controllers/">Controllers</a><ol class=''><li class='level-3 '><a href="../../controllers/">Introduction</a></li><li class='level-3 '><a href="../../controllers/representing-multiple-models-with-arraycontroller/">Representing Multiple Models with ArrayController</a></li><li class='level-3 '><a href="../../controllers/dependencies-between-controllers/">Managing Dependencies Between Controllers</a></li></ol></li><li class='level-1 '><a href="../../models/">Models</a><ol class=''><li class='level-3 '><a href="../../models/">Introduction</a></li><li class='level-3 '><a href="../../models/defining-models/">Defining Models</a></li><li class='level-3 '><a href="../../models/creating-and-deleting-records/">Creating and Deleting Records</a></li><li class='level-3 '><a href="../../models/pushing-records-into-the-store/">Pushing Records into the Store</a></li><li class='level-3 '><a href="../../models/persisting-records/">Persisting Records</a></li><li class='level-3 '><a href="../../models/finding-records/">Finding Records</a></li><li class='level-3 '><a href="../../models/working-with-records/">Working with Records</a></li><li class='level-3 '><a href="../../models/the-rest-adapter/">The Rest Adapter</a></li><li class='level-3 '><a href="../../models/connecting-to-an-http-server/">Connecting to an HTTP Server</a></li><li class='level-3 '><a href="../../models/handling-metadata/">Handling Metadata</a></li><li class='level-3 '><a href="../../models/customizing-adapters/">Customizing Adapters</a></li><li class='level-3 '><a href="../../models/frequently-asked-questions/">Frequently Asked Questions</a></li></ol></li><li class='level-1 '><a href="../../views/">Views</a><ol class=''><li class='level-3 '><a href="../../views/">Introduction</a></li><li class='level-3 '><a href="../../views/defining-a-view/">Defining a View</a></li><li class='level-3 '><a href="../../views/handling-events/">Handling Events</a></li><li class='level-3 '><a href="../../views/inserting-views-in-templates/">Inserting Views in Templates</a></li><li class='level-3 '><a href="../../views/adding-layouts-to-views/">Adding Layouts to Views</a></li><li class='level-3 '><a href="../../views/customizing-a-views-element/">Customizing a View's Element</a></li><li class='level-3 '><a href="../../views/built-in-views/">Built-in Views</a></li><li class='level-3 '><a href="../../views/manually-managing-view-hierarchy/">Manually Managing View Hierarchy</a></li></ol></li><li class='level-1 '><a href="../../enumerables/">Enumerables</a><ol class=''><li class='level-3 '><a href="../../enumerables/">Introduction</a></li></ol></li><li class='level-1 '><a href="../../testing/">Testing</a><ol class=''><li class='level-3 '><a href="../../testing/">Introduction</a></li><li class='level-3 '><a href="../../testing/acceptance/">Acceptance Tests</a></li><li class='level-3 '><a href="../../testing/test-helpers/">Test Helpers</a></li><li class='level-3 '><a href="../../testing/testing-user-interaction/">Testing User Interaction</a></li><li class='level-3 '><a href="../../testing/unit-testing-basics/">Unit Testing Basics</a></li><li class='level-3 '><a href="../../testing/unit-test-helpers/">Unit Test Helpers</a></li><li class='level-3 '><a href="../../testing/testing-components/">Testing Components</a></li><li class='level-3 '><a href="../../testing/testing-controllers/">Testing Controllers</a></li><li class='level-3 '><a href="../../testing/testing-routes/">Testing Routes</a></li><li class='level-3 '><a href="../../testing/testing-models/">Testing Models</a></li></ol></li><li class='level-1 '><a href="../../configuring-ember/disabling-prototype-extensions/">Configuring Ember.js</a><ol class=''><li class='level-3 '><a href="../../configuring-ember/disabling-prototype-extensions/">Disabling Prototype Extensions</a></li><li class='level-3 '><a href="../../configuring-ember/embedding-applications/">Embedding Applications</a></li><li class='level-3 '><a href="../../configuring-ember/feature-flags/">Feature Flags</a></li></ol></li><li class='level-1 '><a href="../../ember-inspector/installation/">Ember Inspector</a><ol class=''><li class='level-3 '><a href="../../ember-inspector/installation/">Installing the Inspector</a></li><li class='level-3 '><a href="../../ember-inspector/object-inspector/">Object Inspector</a></li><li class='level-3 '><a href="../../ember-inspector/view-tree/">The View Tree</a></li><li class='level-3 '><a href="../../ember-inspector/routes/">Inspecting Routes</a></li><li class='level-3 '><a href="../../ember-inspector/data/">Data Tab</a></li><li class='level-3 '><a href="../../ember-inspector/deprecations/">Tackling Deprecations</a></li><li class='level-3 '><a href="../../ember-inspector/info/">Library Info</a></li><li class='level-3 '><a href="../../ember-inspector/promises/">Debugging Promises</a></li><li class='level-3 '><a href="../../ember-inspector/container/">Inspecting the Container</a></li><li class='level-3 '><a href="../../ember-inspector/render-performance/">Rendering Performance</a></li><li class='level-3 '><a href="../../ember-inspector/troubleshooting/">Troubleshooting</a></li></ol></li><li class='level-1 '><a href="../../cookbook/">Cookbook</a><ol class=''><li class='level-3 '><a href="../../cookbook/">Introduction</a></li><li class='level-3 '><a href="../../cookbook/contributing/">Contributing</a></li><li class='level-3 '><a href="../../cookbook/user_interface_and_interaction/">User Interface and Interaction</a></li><li class='level-3 '><a href="../../cookbook/event_handling_and_data_binding/">Event Handling & Data Binding</a></li><li class='level-3 '><a href="../../cookbook/helpers_and_components/">Helpers & Components</a></li><li class='level-3 '><a href="../../cookbook/working_with_objects/">Working with Objects</a></li></ol></li><li class='level-1 '><a href="../../understanding-ember/the-view-layer/">Understanding Ember.js</a><ol class=''><li class='level-3 '><a href="../../understanding-ember/the-view-layer/">The View Layer</a></li><li class='level-3 '><a href="../../understanding-ember/managing-asynchrony/">Managing Asynchrony</a></li><li class='level-3 '><a href="../../understanding-ember/debugging/">Debugging</a></li><li class='level-3 '><a href="../../understanding-ember/run-loop/">The Run Loop</a></li><li class='level-3 '><a href="../../understanding-ember/dependency-injection-and-service-lookup/">Dependency Injection & Service Lookup</a></li></ol></li><li class='level-1 '><a href="../../contributing/adding-new-features/">Contributing to Ember.js</a><ol class=''><li class='level-3 '><a href="../../contributing/adding-new-features/">Adding New Features</a></li><li class='level-3 '><a href="../../contributing/repositories/">Repositories</a></li></ol></li></ol>
          <div id="back-to-top"><a id="back-top-top" href="#">&#11014; Back to Top</a></div>
        </div>
      </div>
      <div id="content" class="has-sidebar">
        <div class="chapter">
          
          <hr>

          <h3 class='anchorable-toc' id='toc_router-flow-from-link-to'>Router flow from link-to</h3>
<p>In this guide we will explore the steps Ember performs when a user
clicks on a link generated by the <code>link-to</code> helper. Ember has a number
of useful hooks you can overwrite to run code during the various
phases of the transition.</p>

<p>Lets imagine a user is on the <code>/about/faq/</code> page of an application
with the following router.</p>
<div class="highlight javascript "><div class="ribbon"></div><div class="scroller"><table class="CodeRay">
  <thead>
    <tr>
      <td colspan="2">app/router.js</td>
    </tr>
  </thead>
<tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
</pre></td>
  <td class="code"><pre>Router.map(<span class="keyword">function</span>() {
  <span class="local-variable">this</span>.route(<span class="string"><span class="delimiter">'</span><span class="content">about</span><span class="delimiter">'</span></span>, <span class="keyword">function</span>() {
    <span class="local-variable">this</span>.route(<span class="string"><span class="delimiter">'</span><span class="content">faq</span><span class="delimiter">'</span></span>);
  });

  <span class="local-variable">this</span>.route(<span class="string"><span class="delimiter">'</span><span class="content">user</span><span class="delimiter">'</span></span>, { <span class="key">path</span>: <span class="string"><span class="delimiter">'</span><span class="content">/user/:user_id</span><span class="delimiter">'</span></span> }, <span class="keyword">function</span>() {
    <span class="local-variable">this</span>.route(<span class="string"><span class="delimiter">'</span><span class="content">profile</span><span class="delimiter">'</span></span>);
  });
});
</pre></td>
</tr></table>
</div></div>
<p>This would mean there are currently three nested active routes in this
application. The <code>route:application</code>, <code>route:about</code> and the <code>route:about-faq</code>.</p>

<p><img src="../images/guides/routing/active-route.png" alt="Active route" class="highlight"></p>

<p>Lets assume a user clicks on a <code>link-to</code> for the <code>controller:user/profile</code> like
the one below.</p>
<div class="highlight handlebars "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre><span class="inline"><span class="inline-delimiter">{{#</span><span class="attribute-name">link-to</span> <span class="error">'</span><span class="attribute-name">user.profile</span><span class="error">'</span> <span class="attribute-name">user</span><span class="inline-delimiter">}}</span></span>Visit your user profile<span class="inline"><span class="inline-delimiter">{{/</span><span class="attribute-name">link-to</span><span class="inline-delimiter">}}</span></span>
</pre></td>
</tr></table>
</div></div>
<p>Ember will perform a number of steps before transition a user to the
user profile page. Broadly these steps are grouped into three phases,
the Pre Transition Phase, the Model Resolution Phase and the Sync
Phase. We will explore these phases in more depth below.</p>
<h4 class='anchorable-toc' id='toc_pre-transition-phase'>Pre-Transition Phase</h4>
<p>First Ember will create a transition object. This object is a promise
which will be resolved when the transition is complete or rejected
when the random is aborted. The transition object can be used to abort
the transition by calling <code>transition.abort()</code>.</p>

<p>Next Ember will trigger a <code>willTransition</code> action on the currently
active routes starting with the leaf-most route (in this example the
<code>AboutFaqRoute</code>).</p>

<p><img src="../images/guides/routing/willtransition-event.png" alt="Active route" class="highlight"></p>

<p>The argument for the <code>willTransition</code> action is the transition
object. This gives each active route, the opportunity to decide
whether or not the transition should occur. The code to intercept the
<code>willTransition</code> action and abort a transition might looks something
like this.</p>
<div class="highlight javascript "><div class="ribbon"></div><div class="scroller"><table class="CodeRay">
  <thead>
    <tr>
      <td colspan="2">app/routes/about-faq.js</td>
    </tr>
  </thead>
<tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
<strong>10</strong>
11
12
13
14
</pre></td>
  <td class="code"><pre><span class="reserved">export</span> <span class="keyword">default</span> Ember.Route.extend({
  <span class="key">actions</span>: {
    <span class="function">willTransition</span>: <span class="keyword">function</span>(transition) {
      <span class="keyword">if</span> (<span class="local-variable">this</span>.controllerFor(<span class="string"><span class="delimiter">'</span><span class="content">form</span><span class="delimiter">'</span></span>).get(<span class="string"><span class="delimiter">'</span><span class="content">userHasEnteredData</span><span class="delimiter">'</span></span>) &amp;&amp;
          !confirm(<span class="string"><span class="delimiter">&quot;</span><span class="content">Are you sure you want to abandon progress?</span><span class="delimiter">&quot;</span></span>)) {
        transition.abort();
      } <span class="keyword">else</span> {
        <span class="comment">// Bubble the `willTransition` action so that</span>
        <span class="comment">// parent routes can decide whether or not to abort.</span>
        <span class="keyword">return</span> <span class="predefined-constant">true</span>;
      }
    }
  }
});
</pre></td>
</tr></table>
</div></div>
<p>If the transition is not aborted then Ember will attempt to resolve
the model.</p>
<h4 class='anchorable-toc' id='toc_model-resolution-validation-phase'>Model Resolution / Validation Phase</h4>
<p>The purpose of this phase is both to collect and resolve all model
promises for newly entered routes (or routes with updated contexts),
as well as allow for any of the
<a href="http://emberjs.com/api/classes/Ember.Route.html#method_beforeModel">beforeModel</a>
/
<a href="http://emberjs.com/api/classes/Ember.Route.html#method_model">model</a>
/
<a href="http://emberjs.com/api/classes/Ember.Route.html#method_afterModel">afterModel</a>
hooks to reject elsewhere. If any of these hooks return a promise, the
transition will pause until the promise resolves/rejects.</p>

<p><img src="../images/guides/routing/route-model-validation.png" alt="Active route" class="highlight"></p>

<p>If the promise rejects, and <code>error</code> action is triggered from the
erroring route and upwards with the rejected/thrown error. Calling
<code>transitionTo</code> elsewhere will abort the transition as well (but fire
no errors).</p>
<h4 class='anchorable-toc' id='toc_sync-exit-enter-setup-phase'>Sync exit/enter/setup Phase</h4>
<p>After the transition has been validated and any models are resolved
ember enters the Sync exit/enter/setup Phase. Here Ember calls
<a href="http://emberjs.com/api/classes/Ember.Route.html#method_exit">exit</a> on the existing
routes and
<a href="http://emberjs.com/api/classes/Ember.Route.html#method_enter">enter</a>
/
<a href="http://emberjs.com/api/classes/Ember.Route.html#method_setup">setup</a>
on the newly entered routes.</p>

<p><img src="../images/guides/routing/sync-phase.png" alt="Active route" class="highlight"></p>

<p>If any errors are thrown, the transition promise will be rejected and
the <code>error</code> action will be triggered from the erroring route and
upwards with the rejected/thrown error.</p>

<p>If no errors are thrown then the internal transition promise is
resolved and the user is now on the profile page.</p>
<h3 class='anchorable-toc' id='toc_more-resources'>More Resources</h3>
<ul>
<li><a href="./preventing-and-retrying-transitions">Preventing and retrying transitions</a></li>
<li><a href="https://www.youtube.com/watch?v=EwkaMRJ2tMo">Ember.js: Transition promises, redirects</a></li>
</ul>



          
      <footer>
        <a class="previous-guide" href="../../templates/writing-helpers/"> ← Writing Helpers</a> <a class="next-guide" href="../../components/">We're done with Routing. Next up: Components - Introduction →</a>
      </footer>
      
        </div>
      </div>
    </div>

    <div id="footer">
      <div id="footer-wrapper">
        <div class="info">
          Copyright 2015 <a href="http://tilde.io">Tilde Inc.</a><br>
          <a href="http://emberjs.com/team">Core Team</a> | <a href="http://emberjs.com/sponsors">Sponsors</a> | <a href="http://emberjs.com/legal">Legal</a></br>
          <a href="http://emberjs.com/guidelines">Community Guidelines</a>
        </div>
        <div class="statement">Ember.js is free, open source and always will be.</div>
        <div class="links">
          <a class="twitter" href="http://twitter.com/emberjs">
            <i class="icon-twitter"></i><span>Twitter</span>
          </a>
          <a class="github" href="https://github.com/emberjs/ember.js">
            <i class="icon-github"></i><span>GitHub</span>
          </a>
          <a class="googleplus" href="https://plus.google.com/communities/106387049790387471205">
            <i class="icon-gplus"></i><span>Google+</span>
          </a>
        </div>
      </div>
    </div>

    

    <script src="../../javascripts/guides.js" type="text/javascript"></script>
    <script src="http://static.jsbin.com/js/embed.js"></script>

    <script type="text/javascript">
      var _gaq = _gaq || [];
      var pluginUrl = '//www.google-analytics.com/plugins/ga/inpage_linkid.js';
      _gaq.push(['_require', 'inpage_linkid', pluginUrl]);
      _gaq.push(['_setAccount', 'UA-27675533-1']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
  </body>
</html>
